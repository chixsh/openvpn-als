//
// This is the first database created so is the best place to create the functions
//

//CREATE ALIAS PASSWORD FOR 'com.adito.jdbc.hsqldb.DBFunctions.password';
//CREATE ALIAS ENCODE FOR 'com.adito.jdbc.hsqldb.DBFunctions.encode';
//CREATE ALIAS DECODE FOR 'com.adito.jdbc.hsqldb.DBFunctions.decode';
//CREATE ALIAS ENCPASSWORD FOR 'com.adito.jdbc.hsqldb.DBFunctions.encPassword';
//CREATE ALIAS MATCHES FOR 'com.adito.jdbc.hsqldb.DBFunctions.matches';

// DB configuration

SET PROPERTY "hsqldb.cache_scale" 8;


// 
// Properties
//

DROP TABLE EXPLORER_PROPERTIES IF EXISTS;
CREATE CACHED TABLE EXPLORER_PROPERTIES
(
   KEY_1 VARCHAR(255) not null,
   KEY_2 VARCHAR(255) not null,
   KEY_3 VARCHAR(255) not null,
   KEY_4 VARCHAR(255) not null,
   KEY_5 VARCHAR(255) not null,
   VALUE VARCHAR(255) not null
);

CREATE UNIQUE INDEX SYS_IDX_PROPERTY_CONSTRAINT ON EXPLORER_PROPERTIES
(
  KEY_1,
  KEY_2,
  KEY_3,
  KEY_4,
  KEY_5
);

INSERT INTO EXPLORER_PROPERTIES (KEY_1,KEY_2,KEY_3,KEY_4, KEY_5, VALUE) VALUES ('client.heartbeat.interval','',0,'0','','40000');
INSERT INTO EXPLORER_PROPERTIES (KEY_1,KEY_2,KEY_3,KEY_4, KEY_5, VALUE) VALUES ('client.registration.synchronization.timeout','',0,'0','','10000');
INSERT INTO EXPLORER_PROPERTIES (KEY_1,KEY_2,KEY_3,KEY_4, KEY_5, VALUE) VALUES ('client.shutdown.wait','',0,'0','','2500');


//
// Profiles
//

DROP TABLE PROPERTY_PROFILES IF EXISTS;
CREATE CACHED TABLE PROPERTY_PROFILES
(
   ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 0, INCREMENT BY 1) NOT NULL ,
   USERNAME VARCHAR(50) not null,
   SHORT_NAME VARCHAR(255) not null,
   DESCRIPTION VARCHAR(255) not null,
   PARENT_RESOURCE_PERMISSION INTEGER,
   DATE_CREATED TIMESTAMP,
   DATE_AMENDED TIMESTAMP,
   REALM_ID INTEGER DEFAULT 1
);

INSERT INTO PROPERTY_PROFILES (USERNAME,SHORT_NAME,DESCRIPTION,PARENT_RESOURCE_PERMISSION,DATE_CREATED,DATE_AMENDED) VALUES ('','Default','The default profile.',0,NOW(),NOW());


//
// Attributes
//

DROP TABLE ATTRIBUTES IF EXISTS;
CREATE CACHED TABLE ATTRIBUTES
(
   PROPERTY_CLASS VARCHAR(255) DEFAULT 'userAttributes' NOT NULL,
   CLASS_KEY VARCHAR(255) NOT NULL,
   ATTRIBUTE_NAME VARCHAR(255) NOT NULL,
   ATTRIBUTE_VALUE VARCHAR(255),
   CONSTRAINT ATTRIBUTES_PK PRIMARY KEY (PROPERTY_CLASS,CLASS_KEY,ATTRIBUTE_NAME)
);


//
// Attribute definitions
//

DROP TABLE ATTRIBUTE_DEFINITION IF EXISTS;
CREATE CACHED TABLE ATTRIBUTE_DEFINITION
(
   NAME VARCHAR(255),
   PROPERTY_CLASS VARCHAR(255) DEFAULT 'userAttributes',
   VISIBILITY TINYINT NOT NULL,
   TYPE TINYINT NOT NULL,
   SORT_ORDER INTEGER NOT NULL,
   TEXT_LABEL VARCHAR(255) NOT NULL,
   TEXT_DESCRIPTION VARCHAR(65535) NOT NULL,
   TYPE_META VARCHAR(255) NOT NULL,
   CATEGORY INTEGER NOT NULL,
   CATEGORY_LABEL VARCHAR(255) NOT NULL,
   DEFAULT_VALUE VARCHAR(255) NOT NULL,
   HIDDEN TINYINT,
   VALIDATION_STRING VARCHAR(255) NOT NULL,
   CONSTRAINT ATTRIBUTE_DEFINITION_PK PRIMARY KEY (NAME,PROPERTY_CLASS)
);

